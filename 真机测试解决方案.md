# 真机测试网络请求错误解决方案

## 问题描述

在真机上测试微信小程序时，出现以下错误：
```
request:fail invalid url "/api/auth/wechat-login"
```

## 原因分析

1. 真机环境无法访问 localhost
2. 微信小程序对网络请求有严格的域名限制
3. 开发环境和生产环境的网络配置不同

## 立即解决方案

### 方案1：使用局域网IP（最快）

**步骤1：获取本机IP地址**
```bash
# macOS/Linux
ifconfig | grep "inet " | grep -v 127.0.0.1

# Windows
ipconfig
```

**步骤2：修改前端配置**
编辑 `utils/config.js` 文件：
```javascript
development: {
  baseURL: 'http://你的IP地址:8000', // 例如：http://192.168.1.100:8000
  timeout: 10000
}
```

**步骤3：在微信开发者工具中设置**
1. 点击右上角 "详情"
2. 勾选 "不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书"
3. 重新编译项目

### 方案2：使用内网穿透（推荐用于正式测试）

**步骤1：安装 ngrok**
```bash
# 下载并安装 ngrok
# 访问 https://ngrok.com/ 注册账号
```

**步骤2：启动内网穿透**
```bash
ngrok http 8000
```

**步骤3：修改前端配置**
将 ngrok 提供的 HTTPS 地址配置到 `utils/config.js`：
```javascript
development: {
  baseURL: 'https://xxxxx.ngrok.io', // ngrok提供的地址
  timeout: 10000
}
```

**步骤4：配置微信公众平台**
1. 登录微信公众平台
2. 开发 -> 开发管理 -> 开发设置
3. 在 "服务器域名" 中添加 ngrok 提供的域名

## 当前后端服务状态

✅ 后端服务已启动并运行在：`http://0.0.0.0:8000`
✅ 支持局域网访问
✅ API文档地址：`http://localhost:8000/docs`

## 验证步骤

1. **确认后端可访问**
   - 在浏览器中访问：`http://你的IP:8000/docs`
   - 应该能看到API文档页面

2. **测试网络请求**
   - 在微信开发者工具中测试登录功能
   - 查看Network面板确认请求成功

3. **真机测试**
   - 使用微信扫码预览
   - 测试登录功能是否正常

## 常见问题

**Q: 获取不到本机IP？**
A: 确保电脑和手机连接同一个WiFi网络

**Q: 局域网IP无法访问？**
A: 检查防火墙设置，确保8000端口开放

**Q: ngrok连接失败？**
A: 检查网络连接，或尝试其他内网穿透工具如花生壳

**Q: 微信小程序仍然报错？**
A: 确认在开发者工具中关闭了域名校验

## 生产环境部署

真机测试通过后，生产环境需要：
1. 部署到有公网IP的服务器
2. 配置HTTPS证书
3. 在微信公众平台配置正式域名
4. 修改 `utils/config.js` 中的生产环境配置

---

**注意**：以上方案仅用于开发测试，正式发布前必须配置合法的HTTPS域名。