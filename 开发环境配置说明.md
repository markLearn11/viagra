# 微信小程序开发环境配置说明

## 网络域名配置问题解决方案

当遇到 "不在以下 request 合法域名列表中" 错误时，有以下几种解决方案：

### 方案一：开发者工具设置（推荐用于开发阶段）

1. 打开微信开发者工具
2. 点击右上角的 "详情" 按钮
3. 在 "本地设置" 选项卡中
4. 勾选 "不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书"
5. 重新编译项目

### 方案二：微信公众平台配置（用于正式发布）

1. 登录 [微信公众平台](https://mp.weixin.qq.com/)
2. 进入小程序后台
3. 开发 -> 开发管理 -> 开发设置
4. 在 "服务器域名" 中添加：
   - request合法域名：`https://your-domain.com`
   - 注意：必须是 HTTPS 协议
   - 不能使用 IP 地址和端口号

### 方案三：使用内网穿透工具（开发阶段临时方案）

可以使用 ngrok、花生壳等工具将本地服务映射到公网域名：

```bash
# 使用 ngrok 示例
ngrok http 8000
```

然后将生成的 HTTPS 地址配置到微信公众平台。

## 当前项目配置

项目已经创建了 `utils/config.js` 配置文件，支持：

- 开发环境使用 localhost:8000
- 生产环境使用配置的域名
- 统一的网络请求封装
- 错误处理和超时设置

## 真机测试解决方案

如果在真机上测试遇到网络请求错误，可以使用以下方案：

### 方案A：内网穿透（推荐）

1. 安装 ngrok 或其他内网穿透工具
2. 启动内网穿透：`ngrok http 8000`
3. 修改 `utils/config.js` 中的 baseURL 为 ngrok 提供的 HTTPS 地址
4. 在微信公众平台配置该域名为合法域名

### 方案B：局域网IP

1. 查看本机IP地址：`ifconfig` 或 `ipconfig`
2. 修改后端启动命令，绑定到所有网卡：`uvicorn main:app --reload --host 0.0.0.0 --port 8000`
3. 修改 `utils/config.js` 中的 baseURL 为：`http://你的IP:8000`
4. 确保手机和电脑在同一局域网

## 使用建议

1. **开发阶段**：使用方案一，在开发者工具中关闭域名校验
2. **测试阶段**：使用方案三，通过内网穿透测试真实网络环境
3. **生产发布**：使用方案二，配置正式的 HTTPS 域名

## 注意事项

- 小程序只支持 HTTPS 请求
- 域名必须备案
- 每月只能修改 5 次服务器域名
- 开发版和体验版可以使用开发者工具的域名校验关闭功能
- 正式版必须配置合法域名