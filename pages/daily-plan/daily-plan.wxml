<!-- é¡¶éƒ¨å¯¼èˆª -->
<view class="header">
  <view class="back-btn" bindtap="onBack">
    <text class="back-icon">â€¹</text>
  </view>
  <view class="header-title">ä»Šæ—¥ç–—æ„ˆè®¡åˆ’</view>
  <view class="placeholder"></view>
</view>

<view class="container">

  <!-- è®¡åˆ’æ ‡é¢˜ -->
  <view class="plan-header">
    <view class="plan-title">ä»Šæ—¥ç–—æ„ˆè®¡åˆ’</view>
    <view class="today-plan-btn" bindtap="onViewAllPlans">
      <text class="btn-icon">ğŸ“‹</text>
      <text class="btn-text">æŸ¥çœ‹æ‰€æœ‰è®¡åˆ’</text>
    </view>
  </view>

  <!-- æ²»ç–—è®¡åˆ’å†…å®¹ -->
  <view class="plan-content">
    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{isLoading}}" class="loading-container">
      <view class="loading-spinner"></view>
      <text class="loading-text">{{streamingContent}}</text>
    </view>
    
    <!-- æµå¼å†…å®¹æ˜¾ç¤º - å®æ—¶å¡ç‰‡å¸ƒå±€ -->
    <view wx:elif="{{isStreaming && streamingParsedPlan && streamingParsedPlan.days}}" class="streaming-plan-display">
      <view class="streaming-indicator">
        <view class="streaming-dot"></view>
        <text class="streaming-text">æ­£åœ¨ç”Ÿæˆä»Šæ—¥è®¡åˆ’...</text>
      </view>
      <view class="days-container streaming">
        <view wx:for="{{streamingParsedPlan.days}}" wx:key="day" class="day-card {{item.isStreaming ? 'streaming-card' : ''}}">
          <view class="day-header" bindtap="toggleDay" data-index="{{index}}">
            <view class="day-info">
              <text class="day-title">ä»Šæ—¥è®¡åˆ’</text>
              <text class="day-theme">{{item.theme}}</text>
            </view>
            <view class="expand-icon {{item.expanded ? 'expanded' : ''}}">
              <text>{{item.expanded ? 'âˆ§' : 'âˆ¨'}}</text>
            </view>
          </view>
          
          <view class="day-date" wx:if="{{item.date}}">
            <text class="date-text">({{item.date}})</text>
            <text class="date-desc">{{item.description}}</text>
          </view>
          
          <view wx:if="{{item.expanded}}" class="day-content">
             <view wx:for="{{item.tasks}}" wx:for-item="task" wx:for-index="taskIndex" wx:key="id" class="task-item {{item.isStreaming ? 'streaming-task' : ''}}">
               <view class="task-check {{task.completed ? 'completed' : ''}}" bindtap="toggleTask" data-day-index="{{index}}" data-task-index="{{taskIndex}}">
                 <text wx:if="{{task.completed}}">âœ“</text>
               </view>
               <text class="task-text {{task.completed ? 'completed' : ''}}">{{task.text}}</text>
             </view>
           </view>
        </view>
      </view>
    </view>
    
    <!-- çº¯æ–‡æœ¬æµå¼å†…å®¹æ˜¾ç¤ºï¼ˆå¤‡ç”¨ï¼‰ -->
    <view wx:elif="{{streamingContent}}" class="streaming-container">
      <view class="streaming-indicator">
        <view class="streaming-dot"></view>
        <text class="streaming-text">æ­£åœ¨ç”Ÿæˆä»Šæ—¥è®¡åˆ’...</text>
      </view>
      <text class="plan-text streaming">{{streamingContent}}</text>
    </view>
    
    <!-- æœ€ç»ˆå†…å®¹æ˜¾ç¤º - å¡ç‰‡å¼å¸ƒå±€ -->
    <view wx:elif="{{parsedPlan && parsedPlan.days}}" class="treatment-plan-display">
      <view class="days-container">
        <view wx:for="{{parsedPlan.days}}" wx:key="day" class="day-card">
          <view class="day-header" bindtap="toggleDay" data-index="{{index}}">
            <view class="day-info">
              <text class="day-title">ä»Šæ—¥è®¡åˆ’</text>
              <text class="day-theme">{{item.theme}}</text>
            </view>
            <view class="expand-icon {{item.expanded ? 'expanded' : ''}}">
              <text>{{item.expanded ? 'âˆ§' : 'âˆ¨'}}</text>
            </view>
          </view>
          
          <view class="day-date" wx:if="{{item.date}}">
            <text class="date-text">({{item.date}})</text>
            <text class="date-desc">{{item.description}}</text>
          </view>
          
          <view wx:if="{{item.expanded}}" class="day-content">
             <view wx:for="{{item.tasks}}" wx:for-item="task" wx:for-index="taskIndex" wx:key="id" class="task-item">
               <view class="task-check {{task.completed ? 'completed' : ''}}" bindtap="toggleTask" data-day-index="{{index}}" data-task-index="{{taskIndex}}">
                 <text wx:if="{{task.completed}}">âœ“</text>
               </view>
               <text class="task-text {{task.completed ? 'completed' : ''}}">{{task.text}}</text>
             </view>
           </view>
        </view>
      </view>
    </view>
    
    <!-- æ–‡æœ¬æ ¼å¼æ˜¾ç¤º -->
    <view wx:elif="{{treatmentPlan}}" class="treatment-plan-display">
      <view class="text-plan">
        <text class="plan-text">{{treatmentPlan}}</text>
      </view>
    </view>
    
    <view wx:else class="no-plan">
      <text class="no-plan-text">æš‚æ— ä»Šæ—¥è®¡åˆ’å†…å®¹</text>
    </view>
  </view>
</view>