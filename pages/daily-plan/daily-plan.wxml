<!-- é¡¶éƒ¨å¯¼èˆª -->
<view class="header">
  <view class="back-btn" bindtap="onBack">
    <text class="back-icon">â€¹</text>
  </view>
  <view class="header-title">ä»Šæ—¥ç–—æ„ˆè®¡åˆ’</view>
  <view class="placeholder"></view>
</view>

<view class="container">

  <!-- è®¡åˆ’æ ‡é¢˜ -->
  <view class="plan-header">
    <view class="plan-title">ä»Šæ—¥ç–—æ„ˆè®¡åˆ’</view>
    <view class="today-plan-btn" bindtap="onViewAllPlans">
      <text class="btn-icon">ğŸ“‹</text>
      <text class="btn-text">æŸ¥çœ‹æ‰€æœ‰è®¡åˆ’</text>
    </view>
  </view>

  <!-- æ²»ç–—è®¡åˆ’å†…å®¹ -->
  <view class="plan-content">
    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{isLoading && !isStreaming}}" class="loading-container">
      <view class="loading-spinner"></view>
      <text class="loading-text">æ­£åœ¨è·å–ä»Šæ—¥ç–—æ„ˆè®¡åˆ’...</text>
    </view>
    
    <!-- æµå¼ç”ŸæˆçŠ¶æ€ -->
    <view wx:elif="{{isStreaming}}" class="streaming-container">
      <view class="streaming-indicator">
        <view class="streaming-dot"></view>
        <view class="streaming-dot"></view>
        <view class="streaming-dot"></view>
        <text class="streaming-text">æ­£åœ¨ä¸ºæ‚¨ç”Ÿæˆä»Šæ—¥ç–—æ„ˆè®¡åˆ’...</text>
      </view>
      
      <!-- æµå¼å†…å®¹æ˜¾ç¤º -->
      <view wx:if="{{streamingContent}}" class="streaming-content">
        <text class="streaming-text-content">{{streamingContent}}</text>
        <view class="streaming-cursor">|</view>
      </view>
      
      <!-- æµå¼è§£æçš„è®¡åˆ’æ˜¾ç¤º -->
      <view wx:if="{{parsedPlan && parsedPlan.practices}}" class="streaming-plan-display">
        <view class="practices-container streaming">
          <view wx:for="{{parsedPlan.practices}}" wx:key="id" class="practice-card streaming-card">
            <view class="practice-header" bindtap="toggleDay" data-index="{{index}}">
              <view class="practice-info">
                <text class="practice-time-slot">{{item.timeSlot}}</text>
                <text class="practice-title">{{item.title}}</text>
                <text class="practice-duration">{{item.duration}}</text>
              </view>
              <view class="expand-icon {{item.expanded ? 'expanded' : ''}}">
                <text>{{item.expanded ? 'âˆ§' : 'âˆ¨'}}</text>
              </view>
            </view>
            
            <view class="practice-description" wx:if="{{item.description}}">
              <text class="description-text">{{item.description}}</text>
            </view>
            
            <view wx:if="{{item.expanded}}" class="practice-content">
              <!-- ä»»åŠ¡åˆ—è¡¨ -->
              <view wx:if="{{item.tasks && item.tasks.length > 0}}" class="tasks-section">
                <view wx:for="{{item.tasks}}" wx:for-item="task" wx:for-index="taskIndex" wx:key="id" class="task-item">
                  <view class="task-check {{task.completed ? 'completed' : ''}}" bindtap="toggleTask" data-day-index="{{index}}" data-task-index="{{taskIndex}}">
                    <text wx:if="{{task.completed}}">âœ“</text>
                  </view>
                  <text class="task-text {{task.completed ? 'completed' : ''}}">{{task.text}}</text>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- å®Œæ•´è®¡åˆ’æ˜¾ç¤º -->
    <view wx:elif="{{parsedPlan && parsedPlan.practices}}" class="plan-display">
      <view class="practices-container">
        <view wx:for="{{parsedPlan.practices}}" wx:key="id" class="practice-card">
          <view class="practice-header" bindtap="toggleDay" data-index="{{index}}">
            <view class="practice-info">
              <text class="practice-time-slot">{{item.timeSlot}}</text>
              <text class="practice-title">{{item.title}}</text>
              <text class="practice-duration">{{item.duration}}</text>
            </view>
            <view class="expand-icon {{item.expanded ? 'expanded' : ''}}">
              <text>{{item.expanded ? 'âˆ§' : 'âˆ¨'}}</text>
            </view>
          </view>
          
          <view class="practice-description" wx:if="{{item.description}}">
            <text class="description-text">{{item.description}}</text>
          </view>
          
          <view wx:if="{{item.expanded}}" class="practice-content">
            <!-- ä»»åŠ¡åˆ—è¡¨ -->
            <view wx:if="{{item.tasks && item.tasks.length > 0}}" class="tasks-section">
              <view wx:for="{{item.tasks}}" wx:for-item="task" wx:for-index="taskIndex" wx:key="id" class="task-item">
                <view class="task-check {{task.completed ? 'completed' : ''}}" bindtap="toggleTask" data-day-index="{{index}}" data-task-index="{{taskIndex}}">
                  <text wx:if="{{task.completed}}">âœ“</text>
                </view>
                <text class="task-text {{task.completed ? 'completed' : ''}}">{{task.text}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- çº¯æ–‡æœ¬è®¡åˆ’æ˜¾ç¤ºï¼ˆå¤‡ç”¨ï¼‰ -->
    <view wx:elif="{{treatmentPlan}}" class="text-plan">
      <text class="plan-text">{{treatmentPlan}}</text>
    </view>
    
    <!-- æ— è®¡åˆ’çŠ¶æ€ -->
    <view wx:else class="no-plan">
      <text class="no-plan-text">æš‚æ— ä»Šæ—¥è®¡åˆ’</text>
    </view>
  </view>

</view>